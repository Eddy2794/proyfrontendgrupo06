<div class="card shadow-sm mb-5">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0">{{ isEdit ? 'Editar Cuota' : 'Nueva Cuota' }}</h4>
  </div>
  <div class="card-body">
    <form (ngSubmit)="guardar()" *ngIf="!loading">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="alumno_categoria_id" class="form-label">Alumno - Categoría</label>
          <select id="alumno_categoria_id" class="form-select" [(ngModel)]="cuota.alumno_categoria_id" name="alumno_categoria_id" required [disabled]="isEdit" #alumno_categoria_id="ngModel">
            <option [ngValue]="''">Seleccione una relación alumno-categoría</option>
            <option *ngFor="let r of relacionesAlumnoCategoria" [ngValue]="r._id">{{ getNombreRelacion(r) }}</option>
          </select>
          <div *ngIf="alumno_categoria_id.invalid && alumno_categoria_id.touched" class="text-danger small">
            La relación alumno-categoría es obligatoria.
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <label for="estado" class="form-label">Estado</label>
          <select id="estado" class="form-select" [(ngModel)]="cuota.estado" name="estado" required [disabled]="true" #estado="ngModel">
            <option *ngFor="let e of estados" [ngValue]="e.value">{{ e.label }}</option>
          </select>
          <div *ngIf="estado.invalid && estado.touched" class="text-danger small">
            El estado es obligatorio.
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="mes" class="form-label">Mes</label>
          <select id="mes" class="form-select" [(ngModel)]="cuota.mes" name="mes" required #mes="ngModel">
            <option [ngValue]="''">Seleccione un mes</option>
            <option *ngFor="let m of meses" [ngValue]="m.value">{{ m.label }}</option>
          </select>
          <div *ngIf="mes.invalid && mes.touched" class="text-danger small">
            El mes es obligatorio.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label for="anio" class="form-label">Año</label>
          <input id="anio" type="number" class="form-control" [(ngModel)]="cuota.anio" name="anio" required min="2020" max="2030" #anio="ngModel" />
          <div *ngIf="anio.invalid && anio.touched" class="text-danger small">
            El año es obligatorio y debe estar entre 2020 y 2030.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label for="fecha_vencimiento" class="form-label">Fecha de Vencimiento</label>
          <input id="fecha_vencimiento" type="date" class="form-control" [(ngModel)]="cuota.fecha_vencimiento" name="fecha_vencimiento" required #fecha_vencimiento="ngModel" />
          <div *ngIf="fecha_vencimiento.invalid && fecha_vencimiento.touched" class="text-danger small">
            La fecha de vencimiento es obligatoria.
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="monto" class="form-label">Monto</label>
          <input id="monto" type="number" class="form-control" [(ngModel)]="cuota.monto" name="monto" required min="0" step="0.01" #monto="ngModel" />
          <div *ngIf="monto.invalid && monto.touched" class="text-danger small">
            El monto es obligatorio y debe ser mayor o igual a 0.
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <label for="descuento" class="form-label">Descuento</label>
          <input id="descuento" type="number" class="form-control" [(ngModel)]="cuota.descuento" name="descuento" min="0" step="0.01" />
        </div>
        <div class="col-md-4 mb-3">
          <label for="recargo" class="form-label">Recargo</label>
          <input id="recargo" type="number" class="form-control" [(ngModel)]="cuota.recargo" name="recargo" min="0" step="0.01" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="metodo_pago" class="form-label">Método de Pago</label>
          <input id="metodo_pago" class="form-control" [(ngModel)]="cuota.metodo_pago" name="metodo_pago" />
        </div>
        <div class="col-md-6 mb-3">
          <label for="comprobante_numero" class="form-label">Número de Comprobante</label>
          <input id="comprobante_numero" class="form-control" [(ngModel)]="cuota.comprobante_numero" name="comprobante_numero" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="fecha_pago" class="form-label">Fecha de Pago</label>
          <input id="fecha_pago" type="date" class="form-control" [(ngModel)]="cuota.fecha_pago" name="fecha_pago" />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Total a Pagar</label>
          <div class="form-control-plaintext fw-bold text-success">
            {{ calcularTotal() | number:'1.2-2' }}&nbsp;ARS
          </div>
        </div>
      </div>
      <div class="mb-3">
        <label for="observaciones" class="form-label">Observaciones</label>
        <textarea id="observaciones" class="form-control" [(ngModel)]="cuota.observaciones" name="observaciones" rows="3"></textarea>
        <div class="form-text">Opcional</div>
      </div>
      <div class="d-flex justify-content-end gap-3 mt-4">
        <button type="submit" class="btn btn-success btn-lg px-4">
          <i class="bi bi-save me-2"></i> Guardar
        </button>
        <button type="button" class="btn btn-secondary btn-lg px-4" (click)="cancelar()">
          <i class="bi bi-x-lg me-2"></i> Cancelar
        </button>
      </div>
    </form>
    <div *ngIf="loading">
      <p>Cargando...</p>
    </div>
  </div>
</div>
