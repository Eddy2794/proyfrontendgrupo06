<c-row>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-header class="d-flex justify-content-between align-items-center">
        <div>
          <strong>Gestión de Categorías</strong>
          <small class="text-body-secondary ms-2">Administrar categorías de entrenamiento</small>
        </div>
        <button 
          cButton 
          color="primary" 
          size="sm"
          (click)="agregarCategoria()"
          cTooltip="Agregar nueva categoría">
          <svg cIcon name="cilPlus" class="me-1"></svg>
          Nueva Categoría
        </button>
      </c-card-header>
      
      <c-card-body>
        <!-- Barra de búsqueda y filtros -->
        <c-row class="mb-3">
          <c-col md="4">
            <c-input-group>
              <span cInputGroupText>
                <svg cIcon name="cilSearch"></svg>
              </span>
              <input 
                cFormControl 
                placeholder="Buscar por nombre o descripción..."
                [value]="searchTerm"
                (input)="onSearch($any($event.target).value)"
                type="text">
            </c-input-group>
          </c-col>
          <c-col md="2">
            <select 
              class="form-select"
              [value]="filtroEstado || ''"
              (change)="onFiltroEstadoChange($any($event.target).value || undefined)"
              aria-label="Filtrar por estado">
              <option value="">Todos los estados</option>
              <option value="activa">Activas</option>
              <option value="inactiva">Inactivas</option>
            </select>
          </c-col>
          <c-col md="2">
            <select 
              class="form-select"
              [value]="filtroNivel || ''"
              (change)="onFiltroNivelChange($any($event.target).value || undefined)"
              aria-label="Filtrar por nivel">
              <option value="">Todos los niveles</option>
              <option *ngFor="let nivel of nivelesDisponibles" [value]="nivel">{{ nivel }}</option>
            </select>
          </c-col>
          <c-col md="2">
            <button 
              cButton 
              color="secondary" 
              variant="outline"
              size="sm"
              (click)="limpiarFiltros()"
              cTooltip="Limpiar filtros">
              <svg cIcon name="cilReload" class="me-1"></svg>
              Limpiar
            </button>
          </c-col>
          <c-col md="2" class="text-end">
            <small class="text-body-secondary">
              {{ paginatedItems.length }} de {{ totalItems }} categorías
            </small>
          </c-col>
        </c-row>

        <!-- Mensaje de error -->
        <c-alert 
          *ngIf="errorMessage" 
          color="danger" 
          [dismissible]="true"
          (dismissed)="clearMessages()">
          {{ errorMessage }}
        </c-alert>

        <!-- Mensaje de éxito -->
        <c-alert 
          *ngIf="successMessage" 
          color="success" 
          [dismissible]="true"
          (dismissed)="clearMessages()">
          {{ successMessage }}
        </c-alert>

        <!-- Spinner de carga -->
        <div *ngIf="loading" class="text-center py-4">
          <c-spinner color="primary"></c-spinner>
          <p class="mt-2 text-body-secondary">Cargando categorías...</p>
        </div>

        <!-- Tabla de categorías -->
        <div *ngIf="!loading" class="table-responsive">
          <table cTable [hover]="true" [striped]="true">
            <thead>
              <tr>
                <th scope="col">Categoría</th>
                <th scope="col">Nivel</th>
                <th scope="col">Rango de Edad</th>
                <th scope="col">Cuota Mensual</th>
                <th scope="col">Ocupación</th>
                <th scope="col">Estado</th>
                <th scope="col" class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let categoria of paginatedItems; trackBy: trackByCategoria">
                <!-- Categoría -->
                <td>
                  <div>
                    <div class="fw-semibold">{{ categoria.nombre }}</div>
                    <small class="text-body-secondary">{{ categoria.descripcion || 'Sin descripción' }}</small>
                  </div>
                </td>

                <!-- Nivel -->
                <td>
                  <c-badge 
                    [color]="getLevelBadgeColor(categoria.nivel)"
                    class="me-1">
                    {{ categoria.nivel }}
                  </c-badge>
                </td>

                <!-- Rango de Edad -->
                <td>
                  <small>{{ formatAgeRange(categoria) }}</small>
                </td>

                <!-- Cuota Mensual -->
                <td>
                  <span class="fw-semibold">${{ (categoria.cuota_mensual || categoria.precio?.cuotaMensual || 0) | number:'1.0-0' }}</span>
                </td>

                <!-- Ocupación -->
                <td>
                  <div class="d-flex align-items-center">
                    <small class="me-2">{{ (categoria.alumnos_actuales || categoria.alumnosActuales || 0) }}/{{ (categoria.max_alumnos || categoria.cupoMaximo || 0) }}</small>
                    <div class="progress" style="width: 60px; height: 8px;">
                      <div 
                        class="progress-bar" 
                        [class]="'bg-' + getOccupancyColor(getOccupancyPercentage(categoria))"
                        [style.width.%]="getOccupancyPercentage(categoria)">
                      </div>
                    </div>
                    <small class="ms-2">{{ getOccupancyPercentage(categoria) | number:'1.0-0' }}%</small>
                  </div>
                </td>

                <!-- Estado -->
                <td>
                  <c-badge 
                    [color]="getBadgeClass(categoria)"
                    class="me-1">
                    {{ getEstadoText(categoria) }}
                  </c-badge>
                  <br>
                  <button 
                    cButton 
                    size="sm" 
                    variant="outline" 
                    [color]="getEstadoActivo(categoria) ? 'warning' : 'success'"
                    class="mt-1 w-100"
                    style="min-width: 100px;"
                    (click)="cambiarEstadoCategoria(categoria, !getEstadoActivo(categoria))"
                    [cTooltip]="getButtonText(categoria)">
                    <svg cIcon [name]="getButtonIcon(categoria)" size="sm" class="me-1"></svg>
                    {{ getEstadoActivo(categoria) ? 'Desactivar' : 'Activar' }}
                  </button>
                </td>

                <!-- Acciones -->
                <td class="text-center">
                  <div class="btn-group" role="group">
                    <button 
                      cButton 
                      size="sm" 
                      variant="outline" 
                      color="info"
                      (click)="editarCategoria(categoria)"
                      cTooltip="Editar categoría">
                      <svg cIcon name="cilPencil" size="sm"></svg>
                    </button>
                    
                    <button 
                      cButton 
                      size="sm" 
                      variant="outline" 
                      color="danger"
                      (click)="confirmarEliminacion(categoria)"
                      cTooltip="Eliminar categoría">
                      <svg cIcon name="cilTrash" size="sm"></svg>
                    </button>
                  </div>
                </td>
              </tr>

              <!-- Mensaje cuando no hay categorías -->
              <tr *ngIf="paginatedItems.length === 0">
                <td colspan="7" class="text-center py-4">
                  <div class="text-body-secondary">
                    <svg cIcon name="cilFolder" size="xl" class="mb-2"></svg>
                    <p class="mb-0">No se encontraron categorías</p>
                    <small>{{ searchTerm ? 'Intenta con otros términos de búsqueda' : 'Comienza agregando una nueva categoría' }}</small>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginación -->
         <div *ngIf="totalPages > 1" class="d-flex justify-content-center mt-3">
           <nav aria-label="Paginación de categorías">
             <ul class="pagination">
               <li class="page-item" [class.disabled]="currentPage === 1">
                 <a class="page-link" 
                    (click)="currentPage > 1 && onPageChange(currentPage - 1)"
                    style="cursor: pointer;">
                   Anterior
                 </a>
               </li>
               
               <li class="page-item" 
                   *ngFor="let page of [].constructor(totalPages); let i = index"
                   [class.active]="currentPage === i + 1">
                 <a class="page-link" 
                    (click)="onPageChange(i + 1)"
                    style="cursor: pointer;">
                   {{ i + 1 }}
                 </a>
               </li>
               
               <li class="page-item" [class.disabled]="currentPage === totalPages">
                 <a class="page-link" 
                    (click)="currentPage < totalPages && onPageChange(currentPage + 1)"
                    style="cursor: pointer;">
                   Siguiente
                 </a>
               </li>
             </ul>
           </nav>
         </div>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>