<div class="card shadow-sm mb-5">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0">{{ isEdit ? 'Editar Relación' : 'Nueva Relación Alumno-Categoría' }}</h4>
  </div>
  <div class="card-body">
    <form (ngSubmit)="guardar()" *ngIf="!loading">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="alumno" class="form-label">Alumno</label>
          <select id="alumno" class="form-select" [(ngModel)]="relacion.alumno" name="alumno" [disabled]="isEdit" required #alumno="ngModel">
            <option [ngValue]="''">Seleccione un alumno</option>
            <option *ngFor="let a of alumnos" [ngValue]="a._id">{{ a.persona_datos?.nombres }} {{ a.persona_datos?.apellidos }}</option>
          </select>
          <div *ngIf="alumno.invalid && alumno.touched" class="text-danger small">
            El alumno es obligatorio.
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <label for="categoria" class="form-label">Categoría</label>
          <select id="categoria" class="form-select" [(ngModel)]="relacion.categoria" name="categoria" required #categoria="ngModel">
            <option [ngValue]="''">Seleccione una categoría</option>
            <option *ngFor="let c of categorias" [ngValue]="c._id">{{ c.nombre }}</option>
          </select>
          <div *ngIf="categoria.invalid && categoria.touched" class="text-danger small">
            La categoría es obligatoria.
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="fecha_inscripcion" class="form-label">Fecha de Alta</label>
          <input id="fecha_inscripcion" type="date" class="form-control" [(ngModel)]="relacion.fecha_inscripcion" name="fecha_inscripcion" required #fecha_inscripcion="ngModel">
          <div *ngIf="fecha_inscripcion.invalid && fecha_inscripcion.touched" class="text-danger small">
            La fecha de inscripción es obligatoria.
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <label for="estado" class="form-label">Estado</label>
          <select id="estado" class="form-select" [(ngModel)]="relacion.estado" name="estado" required>
            <option value="ACTIVO">Activo</option>
            <option value="INACTIVO">Inactivo</option>
          </select>
        </div>
      </div>
      <div class="mb-3">
        <label for="observaciones" class="form-label">Observaciones</label>
        <textarea id="observaciones" class="form-control" [(ngModel)]="relacion.observaciones" name="observaciones"></textarea>
        <div class="form-text">Opcional</div>
      </div>
      <div class="row" *ngIf="relacion.estado === 'INACTIVO'">
        <div class="col-md-6 mb-3">
          <label for="fecha_baja" class="form-label">Fecha de Baja</label>
          <input id="fecha_baja" type="date" class="form-control" [(ngModel)]="relacion.fecha_baja" name="fecha_baja" />
        </div>
        <div class="col-md-6 mb-3">
          <label for="motivo_baja" class="form-label">Motivo de Baja</label>
          <input id="motivo_baja" class="form-control" [(ngModel)]="relacion.motivo_baja" name="motivo_baja" />
        </div>
      </div>
      <div class="d-flex justify-content-end gap-3 mt-4">
        <button type="submit" class="btn btn-success btn-lg px-4">
          <i class="bi bi-save me-2"></i> Guardar
        </button>
        <button type="button" class="btn btn-secondary btn-lg px-4" (click)="cancelar()">
          <i class="bi bi-x-lg me-2"></i> Cancelar
        </button>
      </div>
    </form>
    <div *ngIf="loading">
      <p>Cargando...</p>
    </div>
  </div>
</div> 